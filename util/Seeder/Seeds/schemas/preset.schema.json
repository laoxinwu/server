{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "preset.schema.json",
  "title": "Bitwarden Seeder Preset",
  "description": "Defines a complete seeding preset that composes organization, users, groups, collections, and ciphers.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string"
    },
    "organization": {
      "type": "object",
      "description": "Organization configuration. Use 'fixture' for a named fixture, or 'name'+'domain' for inline creation.",
      "additionalProperties": false,
      "properties": {
        "fixture": {
          "type": "string",
          "description": "Name of an organization fixture file (e.g., 'dunder-mifflin')."
        },
        "name": {
          "type": "string",
          "description": "Organization display name (used with inline creation)."
        },
        "domain": {
          "type": "string",
          "description": "Organization domain (used with inline creation and generator seeding)."
        },
        "seats": {
          "type": "integer",
          "minimum": 1,
          "default": 10,
          "description": "Number of seats in the organization."
        },
        "planType": {
          "type": "string",
          "enum": ["free", "teams-monthly", "teams-annually", "enterprise-monthly", "enterprise-annually", "teams-starter", "families-annually"],
          "description": "Billing plan type. Defaults to enterprise-annually if omitted."
        }
      }
    },
    "roster": {
      "type": "object",
      "description": "Named roster fixture for users, groups, and collections.",
      "additionalProperties": false,
      "properties": {
        "fixture": {
          "type": "string",
          "description": "Name of a roster fixture file (e.g., 'dunder-mifflin')."
        }
      },
      "required": ["fixture"]
    },
    "users": {
      "type": "object",
      "description": "Generate random users.",
      "additionalProperties": false,
      "properties": {
        "count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of users to generate."
        },
        "realisticStatusMix": {
          "type": "boolean",
          "default": false,
          "description": "When true and count >= 10, creates realistic mix: 85% Confirmed, 5% Invited, 5% Accepted, 5% Revoked."
        }
      },
      "required": ["count"]
    },
    "groups": {
      "type": "object",
      "description": "Generate random groups with user assignment. Distribution shape is configurable via the density block.",
      "additionalProperties": false,
      "properties": {
        "count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of groups to generate."
        }
      },
      "required": ["count"]
    },
    "collections": {
      "type": "object",
      "description": "Generate random collections with user and group assignments. Access patterns are configurable via the density block.",
      "additionalProperties": false,
      "properties": {
        "count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of collections to generate."
        }
      },
      "required": ["count"]
    },
    "folders": {
      "type": "boolean",
      "default": false,
      "description": "When true, generates folders for each user using a realistic distribution."
    },
    "ciphers": {
      "type": "object",
      "description": "Cipher configuration. Use 'fixture' for a named fixture, or 'count' for random generation.",
      "additionalProperties": false,
      "properties": {
        "fixture": {
          "type": "string",
          "description": "Name of a cipher fixture file (e.g., 'autofill-testing')."
        },
        "count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of random ciphers to generate."
        },
        "assignFolders": {
          "type": "boolean",
          "default": false,
          "description": "When true, assigns generated ciphers to user folders round-robin. Requires 'folders' to be true."
        }
      }
    },
    "personalCiphers": {
      "type": "object",
      "description": "Generate personal ciphers for each user's personal vault.",
      "additionalProperties": false,
      "properties": {
        "countPerUser": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of personal ciphers to generate per user."
        }
      },
      "required": ["countPerUser"]
    },
    "policies": {
      "type": "object",
      "description": "Organization policy configuration.",
      "additionalProperties": false,
      "properties": {
        "enableAll": {
          "type": "boolean",
          "default": false,
          "description": "When true, enables all policy types."
        },
        "except": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Policy types to exclude when enableAll is true."
        },
        "enable": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Specific policy types to enable (alternative to enableAll)."
        }
      }
    },
    "sso": {
      "type": "object",
      "description": "Single Sign-On configuration for the organization.",
      "additionalProperties": false,
      "properties": {
        "identifier": {
          "type": "string",
          "description": "SSO organization identifier used in login flows."
        },
        "encryptionType": {
          "type": "string",
          "enum": ["masterPassword", "trustedDevices"],
          "description": "How member keys are protected. 'masterPassword' = standard SSO, 'trustedDevices' = TDE (no master password)."
        },
        "provider": {
          "type": "string",
          "enum": ["oidc", "saml"],
          "description": "Identity provider protocol."
        }
      }
    },
    "density": {
      "type": "object",
      "description": "Density profile controlling how users, groups, collections, and ciphers relate within the seeded organization.",
      "additionalProperties": false,
      "properties": {
        "membership": {
          "type": "object",
          "description": "How users are distributed across groups.",
          "additionalProperties": false,
          "properties": {
            "shape": {
              "type": "string",
              "enum": ["uniform", "powerLaw", "megaGroup"],
              "description": "How users spread across groups. 'uniform' = equal sizes, 'powerLaw' = few large groups and many small, 'megaGroup' = one group gets 90%+ of users."
            },
            "skew": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Skew intensity for powerLaw and megaGroup shapes. Ignored for uniform."
            }
          }
        },
        "collectionFanOut": {
          "type": "object",
          "description": "How collections are assigned to groups.",
          "additionalProperties": false,
          "properties": {
            "min": {
              "type": "integer",
              "minimum": 0,
              "description": "Minimum collections assigned per non-empty group."
            },
            "max": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum collections assigned per non-empty group."
            },
            "shape": {
              "type": "string",
              "enum": ["uniform", "powerLaw", "frontLoaded"],
              "description": "How collections spread across groups. 'uniform' = equal counts, 'powerLaw' = few groups get many collections, 'frontLoaded' = first 10% of collections get max fan-out, rest get min."
            },
            "emptyGroupRate": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Fraction of groups that have zero users assigned to them (0.0-1.0)."
            }
          }
        },
        "directAccessRatio": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Fraction of access paths that are direct CollectionUser assignments. 1.0 = all direct, 0.0 = all group-mediated."
        },
        "permissions": {
          "type": "object",
          "description": "How Manage, ReadOnly, HidePasswords, and ReadWrite permissions are distributed across collection access assignments.",
          "additionalProperties": false,
          "properties": {
            "manage": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Weight for Manage permission (0.0-1.0). All four weights must sum to 1.0."
            },
            "readOnly": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Weight for ReadOnly permission (0.0-1.0). All four weights must sum to 1.0."
            },
            "hidePasswords": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Weight for HidePasswords permission (0.0-1.0). All four weights must sum to 1.0."
            },
            "readWrite": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Weight for ReadWrite permission (0.0-1.0). All four weights must sum to 1.0."
            }
          }
        },
        "cipherAssignment": {
          "type": "object",
          "description": "How ciphers are distributed across collections.",
          "additionalProperties": false,
          "properties": {
            "skew": {
              "type": "string",
              "enum": ["uniform", "heavyRight"],
              "description": "How ciphers spread across collections. 'uniform' = equal counts, 'heavyRight' = few collections hold most ciphers while most collections are sparse."
            },
            "orphanRate": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Fraction of org ciphers with no collection assignment."
            }
          }
        }
      }
    }
  }
}
